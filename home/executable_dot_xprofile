#!/bin/sh

# Run portable keyboard setup if available (handles X11/Wayland). Idempotent.
if [ -x "$HOME/.local/bin/keyboard-setup.sh" ]; then
  "$HOME/.local/bin/keyboard-setup.sh" >/dev/null 2>&1 || true
fi

# Load Xmodmap once if available
if [ -z "${XMODMAP_LOADED:-}" ] && [ -r "$HOME/.Xmodmap" ] && command -v xmodmap >/dev/null 2>&1; then
  xmodmap "$HOME/.Xmodmap" || true
  export XMODMAP_LOADED=1
fi

# Merge Xresources once if available
if [ -z "${XRESOURCES_LOADED:-}" ] && [ -r "$HOME/.Xresources" ] && command -v xrdb >/dev/null 2>&1; then
  xrdb -merge "$HOME/.Xresources" >/dev/null 2>&1 || true
  export XRESOURCES_LOADED=1
fi

export GTK_THEME=Adwaita:dark

# IME (fcitx5) environment (only set if not already defined)
: "${GTK_IM_MODULE:=fcitx}"; export GTK_IM_MODULE
: "${QT_IM_MODULE:=fcitx}"; export QT_IM_MODULE
: "${XMODIFIERS:=@im=fcitx}"; export XMODIFIERS
