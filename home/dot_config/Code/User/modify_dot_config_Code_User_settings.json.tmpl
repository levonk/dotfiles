#!/usr/bin/env bash
set -euo pipefail

# Chezmoi modify script for VS Code settings.json
# - Reads existing JSON from stdin if present, else starts from {}
# - Merges a set of desired settings using jq and prints to stdout

tmp_in="$(mktemp)"
trap 'rm -f "$tmp_in"' EXIT

cat >"$tmp_in" || true

if [ ! -s "$tmp_in" ]; then
  echo '{}' >"$tmp_in"
fi

jq '
  .["editor.insertSpaces"] = false |
  .["editor.tabSize"] = 2 |
  .["files.trimTrailingWhitespace"] = true |
  .["files.insertFinalNewline"] = true |
  .["files.trimFinalNewlines"] = true |
  .["github.copilot.nextEditSuggestions.enabled"] = true |
  .["geminiCode.authMethod"] = "apikey" |
  .["geminiCode.includeRelatedFiles"] = true |
  .["geminicodeassist.codeGenerationPaneViewEnabled"] = true |
  .["geminicodeassist.enableTelemetry"] = false |
  .["chat.mcp.discovery.enabled"] = true |
  .["editor.formatOnSave"] = true |
  .["editor.defaultFormatter"] = "esbenp.prettier-vscode" |
  .["geminicodeassist.verboseLogging"] = true |
  .["geminicodeassist.updateChannel"] = "Insiders" |
  .["github.copilot.chat.agent.thinkingTool"] = true |
  .["github.copilot.chat.editor.temporalContext.enabled"] = true |
  .["github.copilot.chat.completionContext.typescript.mode"] = "on" |
  .["github.copilot.chat.edits.temporalContext.enabled"] = true |
  .["github.copilot.chat.generateTests.codeLens"] = true |
  .["github.copilot.chat.languageContext.fix.typescript.enabled"] = true |
  .["github.copilot.chat.languageContext.inline.typescript.enabled"] = true |
  .["github.copilot.chat.languageContext.typescript.enabled"] = true |
  .["github.copilot.chat.notebook.followCellExecution.enabled"] = true |
  .["editor.dropIntoEditor.preferences"] = [] |
  .["cSpell.enabled"] = true |
  .["cSpell.diagnosticLevel"] = "Hint" |
  .["fontSizeShortcuts.fontSizeDefault"] = 12 |
  .["fontSizeShortcuts.fontSizeIncrement"] = 2 |
  .["fontSizeShortcuts.maxFontSize"] = 24 |
  .["fontSizeShortcuts.minFontSize"] = 8 |
  .["prettier-ts-errors.colorTheme"] = "Default Dark+" |
  .["codesnap.containerBackgroundColor"] = "#0d1117" |
  .["editor.wordWrap"] = "on" |
  .["editor.renderWhitespace"] = "boundary" |
  .["files.encoding"] = "utf8" |
  .["terminal.integrated.fontSize"] = 12 |
  .["workbench.sideBar.location"] = "left" |
  .["codesnap.backgroundColor"] = "#000000" |
  .["codesnap.containerPadding"] = "0px" |
  .["codesnap.transparentBackground"] = true |
  .["cSpell.enableFiletypes"] = ["mdx"] |
  .["diffEditor.ignoreTrimWhitespace"] = false |
  .["editor.detectIndentation"] = true |
  .["editor.fontFamily"] = "Anonymous Pro" |
  .["editor.fontLigatures"] = true |
  .["editor.fontSize"] = 13 |
  .["editor.formatOnPaste"] = false |
  .["editor.inlineSuggest.enabled"] = true |
  .["editor.lineHeight"] = 0 |
  .["editor.linkedEditing"] = true |
  .["editor.minimap.enabled"] = false |
  .["editor.multiCursorModifier"] = "ctrlCmd" |
  .["editor.snippetSuggestions"] = "top" |
  .["editor.suggestSelection"] = "first" |
  .["editor.tokenColorCustomizations"] = {"textMateRules": [
    {"scope": ["keyword.operator", "punctuation.separator"], "settings": {"fontStyle": ""}},
    {"scope": ["comment", "comment.block"], "settings": {"fontStyle": "italic", "foreground": "#F5F"}},
    {"name": "envKeys", "scope": "string.quoted.double.env,source.env,constant.numeric.env", "settings": {"foreground": "#19354900"}}
  ]} |
  .["editor.unicodeHighlight.invisibleCharacters"] = false |
  .["emmet.showAbbreviationSuggestions"] = false |
  .["eslint.enable"] = true |
  .["eslint.validate"] = ["vue", "react", "typescript", "html", "javascript"] |
  .["explorer.openEditors.visible"] = 1 |
  .["extensions.ignoreRecommendations"] = false |
  .["files.autoSave"] = "onWindowChange" |
  .["git.autofetch"] = true |
  .["git.openRepositoryInParentFolders"] = "always" |
  .["markdown.preview.fontSize"] = 36 |
  .["redhat.telemetry.enabled"] = false |
  .["amazonQ.telemetry"] = false |
  .["telemetry.telemetryLevel"] = "off" |
  .["telemetry.enableTelemetry"] = false |
  .["telemetry.enableCrashReporter"] = false |
  .["code-runner.enableAppInsights"] = false |
  .["docker-explorer.enableTelemetry"] = false |
  .["terraform.telemetry.enabledenableTelemetry"] = false |
  .["julia.enableTelemetry"] = false |
  .["screencastMode.keyboardOptions"] = {
    "showCommandGroups": false,
    "showCommands": false,
    "showKeybindings": true,
    "showKeys": false,
    "showSingleEditorCursorMoves": true
  } |
  .["search.exclude"] = {"**/*.code-search": true, "**/bower_components": true, "**/node_modules": true} |
  .["search.useIgnoreFiles"] = false |
  .["svelte.enable-ts-plugin"] = true |
  .["vsicons.dontShowNewVersionMessage"] = true |
  .["window.zoomLevel"] = 4 |
  .["workbench.colorTheme"] = "Just Black" |
  .["workbench.editor.labelFormat"] = "medium" |
  .["workbench.editor.showTabs"] = "none" |
  .["workbench.iconTheme"] = "vscode-icons" |
  .["workbench.startupEditor"] = "newUntitledFile" |
  .["workbench.statusBar.visible"] = false |
  .["[css]"] = {"editor.defaultFormatter": "esbenp.prettier-vscode"} |
  .["[handlebars]"] = {"editor.defaultFormatter": "esbenp.prettier-vscode"} |
  .["[html]"] = {"editor.defaultFormatter": "esbenp.prettier-vscode"} |
  .["[javascript]"] = {"editor.defaultFormatter": "esbenp.prettier-vscode"} |
  .["[javascriptreact]"] = {"editor.defaultFormatter": "esbenp.prettier-vscode"} |
  .["[json]"] = {"editor.defaultFormatter": "esbenp.prettier-vscode"} |
  .["[jsonc]"] = {"editor.defaultFormatter": "esbenp.prettier-vscode"} |
  .["[markdown]"] = {"editor.defaultFormatter": "esbenp.prettier-vscode"} |
  .["[scss]"] = {"editor.defaultFormatter": "esbenp.prettier-vscode"} |
  .["[svelte]"] = {"editor.defaultFormatter": "svelte.svelte-vscode"} |
  .["[typescript]"] = {"editor.defaultFormatter": "esbenp.prettier-vscode"} |
  .["[typescriptreact]"] = {"editor.defaultFormatter": "esbenp.prettier-vscode"} |
  .["github.copilot.enable"] = {"*": true, "plaintext": false, "markdown": true, "scminput": true }
' "$tmp_in"