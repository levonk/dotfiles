#!/usr/bin/env bash
# Wrapper to suggest ripgrep while preserving legacy egrep behavior
# Prints a one-time hint per shell session and invokes system grep -E

case $- in
  *i*)
    if [[ -z "${DOTFILES_HINT_EGREP:-}" ]]; then
      >&2 echo "Hint: egrep is deprecated. Prefer: rg -e PATTERN [PATH ...]"
      export DOTFILES_HINT_EGREP=1
    fi
    ;;
  *) ;;
esac

# Resolve a non-wrapper grep to avoid recursion
resolve_real_grep() {
  local self real cand d
  self="$(readlink -f "$0" 2>/dev/null || printf '%s' "$0")"
  # Preferred absolute locations
  for cand in /usr/bin/grep /bin/grep /usr/local/bin/grep; do
    if [[ -x "$cand" ]]; then
      real="$(readlink -f "$cand" 2>/dev/null || printf '%s' "$cand")"
      [[ "$real" != "$self" ]] && printf '%s' "$cand" && return 0
    fi
  done
  # Path search; skip this wrapper
  IFS=':' read -r -a _path_parts <<< "${PATH:-}"
  for d in "${_path_parts[@]}"; do
    [[ -n "$d" ]] || continue
    cand="$d/grep"
    if [[ -x "$cand" ]]; then
      real="$(readlink -f "$cand" 2>/dev/null || printf '%s' "$cand")"
      [[ "$real" != "$self" ]] && printf '%s' "$cand" && return 0
    fi
  done
  # Last resort
  printf '%s' grep
}

real_grep="$(resolve_real_grep)"
exec "$real_grep" -E "$@"
