#!/usr/bin/env zsh
# shellcheck shell=zsh
#{{- includeTemplate "dot_config/ai/rules/software-dev/meta/chezmoi-managed-header.md.tmpl" (dict "path" .path "name" .name) -}}

# --- Strictness and Error Handling ---

# Minimum version: Zsh ≥ 5.0 (for is-at-least, setopt err_return)
autoload -Uz is-at-least
if ! is-at-least 5.0; then
  echo "ERROR: Zsh ≥ 5.0 required for this script. Current: $ZSH_VERSION" >&2
  exit 1
fi

# Strict behavior: exit on error, treat unset variables as error, fail if any command in a pipeline fails, return non-zero on error
setopt errexit nounset pipefail err_return

# Trap errors: This will catch errors and exit with a non-zero status
TRAPERR() {
  echo "ERROR: Script failed at line $LINENO in ${(%):-%N}" >&2
  exit 1
}

# --- Path Warning for Executable Scripts ---

# Get the canonical absolute path of the script
SCRIPT_PATH="$(realpath "$0" 2>/dev/null || readlink -f "$0" 2>/dev/null || echo "$0")"

_IS_IN_EXPECTED_PATH=0

# Check if script is in ~/.local/bin/ (recursively)
if [[ "${SCRIPT_PATH}" == "${HOME}/.local/bin/"* ]]; then
  _IS_IN_EXPECTED_PATH=1
fi

# Check if script is in ${XDG_CONFIG_HOME:-$HOME/.config}/shells/**/utils/*.zsh
_XDG_CONFIG_HOME_DEFAULT="${HOME}/.config"
_CONFIG_BASE_DIR="${XDG_CONFIG_HOME:-${_XDG_CONFIG_HOME_DEFAULT}}/shells/"

# Using globbing for pattern matching in Zsh
if [[ "${SCRIPT_PATH}" == "${_CONFIG_BASE_DIR}"*/utils/*.zsh ]]; then
  _IS_IN_EXPECTED_PATH=1
fi
unset _XDG_CONFIG_HOME_DEFAULT _CONFIG_BASE_DIR

if (( _IS_IN_EXPECTED_PATH == 0 )); then
  echo "WARNING: This executable Zsh script is recommended to be in '${HOME}/.local/bin/' or '${XDG_CONFIG_HOME:-${HOME}/.config}/shells/**/utils/' for proper management and execution. Current path: '${SCRIPT_PATH}'" >&2
fi
unset _IS_IN_EXPECTED_PATH SCRIPT_PATH


########################################################################
# --- Script logic starts here ---
########################################################################
# Example: Add your executable sh script logic here.
# For example, argument parsing, specific commands, etc.
# {{ .cursor }}

# Exit with success if everything completes
exit 0
