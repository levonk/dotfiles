## Chezmoi main config (templated)
## Managed by chezmoi — see https://www.chezmoi.io/

## PURPOSE
## - Provide sane defaults for tools (edit, diff, merge, pager) based on availability.
## - Optionally enable age identity if a local key exists.
## - Keep config safe across Linux, macOS, and Windows.

## NOTE ON DATA
## - Global static variables live in: {{ joinPath .chezmoi.sourceDir ".." ".chezmoidata.yaml" }}
## - Per-machine dynamic data is generated by: home/current/dot_chezmoidata.yaml.tmpl → ~/.chezmoidata

{{- /* Preferred editor for `chezmoi edit` */ -}}
{{- if lookPath "nvim" }}
[edit]
  command = "nvim"
  args = []
{{- else if lookPath "vim" }}
[edit]
  command = "vim"
  args = []
{{- else if lookPath "nano" }}
[edit]
  command = "nano"
  args = []
{{- end }}

{{- /* External diff: prefer delta if present */ -}}
{{- if lookPath "delta" }}
[diff]
  command = "delta"
  args = ["--line-numbers", "--navigate"]
{{- end }}

{{- /* External merge tool for `chezmoi merge` */ -}}
{{- if lookPath "nvim" }}
[merge]
  command = "nvim"
  args = ["-d"]
{{- else if lookPath "vim" }}
[merge]
  command = "vimdiff"
  args = []
{{- else if lookPath "meld" }}
[merge]
  command = "meld"
  args = []
{{- end }}

{{- /* Pager for long outputs */ -}}
{{- /* Default: disabled to avoid interactive hangs in verbose applies. */ -}}
{{- /* Opt-in by setting CHEZMOI_ENABLE_PAGER=1 and having `less` available. */ -}}
{{- $enablePager := (env "CHEZMOI_ENABLE_PAGER" | default "0") -}}
{{- if and (lookPath "less") (eq $enablePager "1") }}
[pager]
  command = "less"
  args = ["-FRX"]
{{- end }}

{{- /* Optional: age identity if key file exists */ -}}
{{- $ageKey := joinPath .chezmoi.homeDir ".config/age/keys.txt" -}}
{{- with stat $ageKey -}}
{{- if .Exists }}
[age]
  identity = "{{ $ageKey }}"
{{- end }}
{{- end }}

## End of config